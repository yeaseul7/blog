## Github pages React-router 404 Issue

이번에는 CRA를 통해 만든 blog를 github pages에 배포했을 때
react-router에 인해 refresh 후 404 error가 반환되는 문제를 다룰 것이다.

#### 문제 원인

github pages가 정적 사이트 호스팅 서비스 이기 때문

react-router는 새로고침을 하면 클라이언트 측에서 라우팅을 처리한다.
새로 고침을 하거나 경로를 변경하면 페이지가 새로 로드되는 것이 아닌 js가 동적으로 콘텐츠를 변경시킨다.

근데 Github pages는 라우팅을 모르기 때문에 경로가 변경되거나 할 때 경로에 해당하는 파일을 찾으려고 한다.

#### 발생 현상

![error 화면](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASAAAACvCAMAAABqzPMLAAAAmVBMVEXx8fH09PQAAADFxcXHx8f39/fDw8Pv7+/r6+vKysrU1NTo6Ojl5eXZ2dng4ODPz8+9vb2urq6jo6OWlpa3t7eyzOCJiYmpqan59vOUlJTi6O2/0+SryN////+fn5+0zeFcXFyBgYHY4upTU1PJ2eadwNs3Nzd1dXVmZmbP3eiOuNiCstUtLS0kJCR9fX1KSko9PT1sbGyItddkgxPnAAANkUlEQVR4nO2dCXvrphKGGbEvA8iWd9lp3Jy9+///cXeQJdtnb/v0xLkJbxZLgEbSZ0DDgBPGKpVKpVKpVCqVSuVZIc34CsZIuErWN7qgJ4Y8NF2RZT9/3TQ/Wzklq2Ypv3XcS0HapskkkFw2zZufmqY9qQKsaeZVIBIiNINAEJvXer9PzS/7IV3+WgUakD83b4tA8remtK79cqhOTN5TchWIhJg39+0g0O9NoH1IgyzUAf2BVSBWGtYf+9kgUPPT0Lag+UmW383eVoEY6KYxchTo55McRaD9L42QVSBqSW/pofW5QHJDT3ioAjG5at7ugX4reS3Q3jWv97LUoP2NL/DGUIf8K89Z3TebbEigqQ+idpeJQ/Mmx1tf402BrjkT92+aMrKghnUIl+QOvmvlGQO4agtvmmVryPFRxQ+iF31K3jR/tvFFC8RAFvZDH0Qe9S9xT/7P6z0bkiV5RPuXrc/I6SnG5Jumeft707hRlPoUm5hG83CgTuetm0QBUUfzIzAGgYaGBZ8lVyqVSqVSqVQqlUqlUqlUKpVKpVKpVJ42xgdtzHUK6JL6UaEXvBRYLlezkJYShllDRi/SKWD3WbJhQgzKF7Yvd3JMbhzGds4OBy1Xm/u4WrbtvU5v3PIeD7rDP+cbfb95wes75Ian2M3xfh7lyou02W+ckOyAWR5mLCPtCxdecg2i1hXbjS5rX2ZBpcNsjhut53o5F1SXSKBlWM5fsEAsUBfsA3gPbOitkbocSgUTJUOvA9CX99+382IAxuBqu1KpVCqVSqVSeX5A4VvZn+x/YWva+2rR717D9/PhVi45uK5DK09CAEQWB70ATt+S40nBUUdph01KjJYGqNNhZMaDFBKm49hQ9LJ32oxjYTiZoIQhvZiaSk1lT+VwOinkaNy33sgfqFCMcqZ04rTFU4orUzRB5Z3SmeOKS8d5gpQdchN4C+AEzoKeZSoNimsWhWWqNZbbNjrOLPece+b5SioLQ0IAy5NRmElelbRytNU5FJhCp8AUU5rT/XflHJF3CSxdReCpHU8qwyyZsn0LhWIEG11rMynhOUvZzgCUpG8upLBCKilE+Z7ZTK8AVtCN029Ko1siMUUrpEuRCpvWKiVkl8rhVkCxqxSXwKWg78QoudhzRliZRLYxiJMpZWeMSg3nKPt0FVGF65MaR9u3qEOIwKNzOkIgSViykmoQva+K3vqTQJAFo9vmVMVkB8BB0RUPooHGCGrfUQVANELopKMBetMdkHjoEROLXmYShVugegLJeMuE86IInwVGPpjiqYRIVDmHkl2RGNCXd2g6qSCBSPBbCOQ93YOJCZhWMbIM1D4YyRPK9USqX1GIYOm1vNmKxHM2pgjCUSYkajRRoUx0g6mUpRtT1AipAxFOJqT+pSRQz0ZH+EA1jw61IegYE4pYTswGU1SLqTKfzpGZotKBKYyk5HBSquc6lCu6gUAjcP4Z4+zTUwOSYJe0sQOfHm/nThrOZaZO+pIK5zNc718ennD1CCzZOB0H7OpUlzJPjds8PCqVSqVSqVQqt+cLsZy/ccS3Uq985H9v+Mq3hn9s6D+kDHEMc2NwhoWTnz9+nYYWEfz1+ICGY+OAYRx1DM62L6mUT0X9mA80GHOXiBB8PiCBi00PJ8MwmcPTNhlwjqvgbqVQVK20OSuDRjmgUSSNFBFQUwKgs6C5Q39gooyk0ToRKYHLaMQQNjJIBiLSKHSFrWXIw8H4maKhJw/gZ05yr5jjwShEgcobZWiwJcAp7biOooTLyCYN8LtEJYuJkmlkMQfFrhqG+zSyv5lAzgGGLLm1NLDXSXgDAjgfwkGqDL8Nl9aGXP7GBFPAMawsSRKyBuUZ10l5G60UkoRCx0usiIPgvjtFerJXSnKMLYdMeyaDscxgEnRw9mTakM0YVomk0DmQmFZ5XS4hOhtKwIME4hlvLBAvITGkSxzeQp1xSChvG1WTohRyVkJBJUQUrUiJIw3yPd0nSRpUCSpJEalSiDFWRBZOGx26EjoKxVzZs2CSDIJxn7BFB1afbNoSpSNRMjrvEulisWyTbOVKEpW6kUKBbi5Q43IucGpiiDwyyNqrEJSghu95crLTHCFRf0BfyLOTaEqMNNFdKnQykRiJDJAKLnvoqKRWZIa0d5Ea09CLDAeTWVaakBBouUGuqTGXQlRFUlSeTJCwZJbMYfSO0xukSv8zWGC3Cwd9HF5n3o6BmKkTHfLi1HFP8Z4pAn85cAq7j2EluOrtz9uXwD07PxAu+exjc+z8JPjm5Muj85SupfJU+Xqd/SjnMSrT3z3Ho/qL1FWSx3PpB05OnkbwseNJ49gDIAYfr4LO3zD46X701+mTnzi6hGdvtPRseB3F/rqfTg8IeLzpQ3ouSzBK03M3Wi1QumQOWtOeczK6NLiBEFHE4HTZL7ehgemx60VyKqe+fbj57hzvPyWgVFSIvKgYSW565JNbY8gBxZb8CrIqtIjki9KJbQq83D49+8l3kLlooOM4vhjOCvSsj2CK40mX/FgC0XOTXDhFI4JgmcVYZp4GgVplPQmkjIEya+idjS46qVKYJbHyGcl5If/EhcgDUlHMmQ7lUJ7hzOSQhMi2zIXRY91SRjLkBmSTkgsieSMkZBCOTloSRIwmZfIWfSQfgSRzlnXRkPuUMNBV8ORnNmXyt8YpRv1I04dUg2CYPiUXRiuZUmS2CFRqD0vkzEHx1waBOouCanf2yUrjZC7zUxgpr7VUHbDrlMoxCtnZMovOZBfnSmCAkxMsBXl5dKPkVTrynB35ncWrdIZOqjsagESWWkyAdFKqU0wK8pK4cSsV5lR3lOZ23ylO7tLoeNpHEogaDSu+GTUGw5STlstWU89EvjS51h2PiYZTSA3ORx8T6eg0Cqs7v0qypbrnST7RRYUrcuoyNyRVxpZh57suoVOnYVSgNmU4DTucieh5V/xO0rjMxLLiO8okrcJIQzTDVaRKCa4NVGFz7GyreWeoTBLonC02aCco7x9njn7qMNjFPTuvrTj3mNpdZghhXKSRTh/i0VNnUyhpZ+dv9CUjOb75euB+yUzy2o88u54XD/R8MnY5y5UH+oT4wuV86Qq/6jH8o+RKpVKpVCqVyu35jyKY3zDyb+2fgz5wsfL44Vbo+4f1NMzYavoZM7ZHBkdKYOvj9S1epvyKs388LzdM8FHOOBIocRCN50gTO8V9JiMAQcMn92/8lCuzpfFZiB6wDGbQDENGdY4VwePIBf36+M7s1uu77fqh37IP/cNx/XAE+HDU28Vuy9Z3/fphS4W2bLt92O7MesHo9cNxe6c/HEHv1ts7Bp1jVtJ412NIRlrmEZIpK2fRt9E7GWiwGxBi8isPwclYZgMcDYDjMPkDcWbK56TR6bI8GATJtHGzlPmqxf0qRsAukdq5E/OyZjZElE7L9AizrPD+3W67MLudef+wfbVd97t3/bvtjjYetv1deQXKuDs+HHe677evzOIOFv120euHY7/o173ZvWe9tJpr2xngMRsa6QseTqENHgRlBNfKNlruY3JW6BSw1RZIO+cwcu+45FRYBWcNYsuEgBbMgWrOhh+6+eoeZ/tNnm1QqvmhS+1vYdnNxWHulqsfP/+zfnVcrD/c7Xa7vl+THoudXvR3pNSCZCGBqIZRFdrtjus7drdY9+vF+7t+sSaZ+uNiSKA9EoiVCUaAYVJwmGvMNo+rzHUaJmdjFIGjS4IqELeszCcrZ3QSp5X8VNijUxGH1fwC9EHP2jmKnMwMV3LeRVtWnHuJsyW2+3nbtqzdmB9ehaA0oF2/vVv8ZfoPZv3+le5NT41mse0/7Eigd/1fVJXYoj/2f90VPY79AwnUP7xaLN6/Wu9on1Ito3srAg0Tq8oJCDxNy/Ct8ieByrTgquwbQQIlscLMWVJUy0TrIWeSA4tAKFqqUJul3/j7FuUqLufzvFlqyGWScrnBw+EQljksl/7HV6HzJ2roZz1FWk696voqhD5kX5Z60Dbl0gFXU4JT33xeDHJ97BQGugR3PokbsUu4RyZbVndIyehryC7/W0HK0aaU/n6+Kv9tQb7cf0LxvYmTJzW7WqlUKpVKpVKpVCqVSuV5oENZIqjLHz+GIfTuw7Rw50vRCjDBlGw95k7R+svLM8PwJCJfKZkDBGXLL6fmJvuD84GJ8ElxSDZZ70XAueIusKBS1MpvTNZzZ6JUN/l7Lj8SRG8xYadmSqqsM2gljPLYCpMSZhyqRBgoW9pa0SnFOi4wKcGUMspaOsB1IkZVPhfyzCiLXV1ypI7adxkyhACZ6karTFJhXICqB8qWT8qhVVSEY1QCOsWy8ZYn3/EYO/1YK1YfD3AZfejKJ+7Kn1yKwHhmOWRHOojyCZ9PiiubOkSbo00GWU5RYMjQBUXVkHOWn9+fCL5aTHlec3n1cZ1PMUJZjTnCpRj75gEvjulTT5VKpVKpVCqVSqVS+bEA83FY6Vv5IhBVwd36Op4q5S8WDPBbX8kTJeSoMVAby6m2si8AVp3+LrZWzy8k/19Aupw2IH0Wga0QOk8COYW3vZQnCs/h1PcI9ek0WYWVipNs1NRXp6mtVT5GK588Y0qpm/wTg/8DQqlBwMdp1srnaGeopYWqz1d5ngs3KpVKpVKpVCqVSqVSqVSeJv8DbBGneug+U1cAAAAASUVORK5CYII=)

나도 마찬가지로 react-router를 사용중이었고
이 issue에 직면하게 되었다.

### 해결 방법

[CRA Docs](https://create-react-app.dev/docs/deployment/#notes-on-client-side-routing)에 들어가면 이 문제에 대해 상세히 설명해주고 있다.

react-router가 사용하는 `<BrowserRouter />`가 라우팅 과정에서 동적으로 페이지를 변환시켜주는 것이라고 볼 수 있는데 이게 정적 사이트 호스팅을 지원하는 gh pages에서는 동작할 수 없다.

[CRA Docs](https://create-react-app.dev/docs/deployment/#notes-on-client-side-routing)에서 대체적으로 아래의 방법을 사용한다고 하니
나도 [spa github pages](https://github.com/rafgraph/spa-github-pages?tab=readme-ov-file)를 참고해서 문제 해결을 시도했다.

이 방법은 404 에러가 나면 404.html 파일로 보내고 거기서 script로 경로를 찾을 수 있게 해주는 방법이었다.

**두번째 방법을 선택한 이유**
처음에는 404 error가 이 경우밖에 나는건 아닐 수 있는데 이렇게 해도 되나 고민했디.
하지만 redirect 시키며 경로를 찾게 해주는 방법이 대체적으로 많이 쓰이기도 하고
첫번째 방법은 코드를 싹 고쳐야 하는 번거로움이 있다고 생각해서 아래의 방법을 선택했다.

[문서](https://github.com/rafgraph/spa-github-pages?tab=readme-ov-file#usage-instructions)를 보면 실행 절차에 대해 더 자세히 얘기해준다.

1. [404.html](https://github.com/rafgraph/spa-github-pages/blob/gh-pages/404.html)을 그대로 복사해서 루트 디렉토리에 붙여넣는다.
   여기서 만약에 custom domain을 사용하지 않고 있으면 404.html 파일에 pathSegmentsToKeep를 1로 바꿔주고
   react-router를 사용하는 부분도 절대 경로를 repo 이름으로 변경해줘야 한다

```
<BrowserRouter basename="/yeaseul7.github.io">
```

그리고 localhost:3000에서 돌리던 로컬 서버는 기본 경로인 repo name이 추가되었기 때문에
테스트 하려면 localhost:3000/yeaseul7.github.io/로 접속해야한다.
